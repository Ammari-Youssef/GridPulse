<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="system-fix-timestamps-2025-11-08" author="youssef">
        <comment>Ensure all timestamp fields use timezone for OffsetDateTime compatibility</comment>

        <!-- ðŸ§‘ USER DOMAIN -->
        <modifyDataType tableName="_user" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="_user" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="user_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="user_history" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="token" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="token" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- ðŸšš FLEET DOMAIN -->
        <modifyDataType tableName="fleet" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="fleet" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="fleet_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="fleet_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- ðŸ“± DEVICE DOMAIN -->
        <modifyDataType tableName="device" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device" columnName="last_seen" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device" columnName="sw_update_time" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device_history" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device_history" columnName="last_seen" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="device_history" columnName="sw_update_time" newDataType="timestamp with time zone"/>

        <!-- ðŸ”‹ BMS DOMAIN -->
        <modifyDataType tableName="bms" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="bms" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="bms_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="bms_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- âš¡ METER DOMAIN -->
        <modifyDataType tableName="meter" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="meter" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="meter_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="meter_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- ðŸ“¡ MESSAGE DOMAIN -->
        <modifyDataType tableName="messages" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="messages" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="messages" columnName="sent_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="messages" columnName="received_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="message_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="message_history" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="message_history" columnName="sent_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="message_history" columnName="received_at" newDataType="timestamp with time zone"/>

        <!-- â˜€ï¸ INVERTER DOMAIN -->
        <modifyDataType tableName="inverter" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inverter" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inverter_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inverter_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- ðŸ§  INVERTER SUBCOMPONENTS -->
        <modifyDataType tableName="inv_common" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_common" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_common_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_common_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <modifyDataType tableName="inv_nameplate" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_nameplate" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_nameplate_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_nameplate_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <modifyDataType tableName="inv_settings" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_settings" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_settings_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="inv_settings_history" columnName="updated_at" newDataType="timestamp with time zone"/>

        <!-- ðŸ” SECURITY DOMAIN -->
        <modifyDataType tableName="security_keys" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="security_keys" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="security_keys" columnName="revoked_timestamp" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="security_keys_history" columnName="created_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="security_keys_history" columnName="updated_at" newDataType="timestamp with time zone"/>
        <modifyDataType tableName="security_keys_history" columnName="revoked_timestamp" newDataType="timestamp with time zone"/>

        <rollback>

            <!-- ðŸ§‘ USER DOMAIN -->
            <modifyDataType tableName="_user" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="_user" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="user_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="user_history" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="token" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="token" columnName="updated_at" newDataType="timestamp"/>

            <!-- ðŸšš FLEET DOMAIN -->
            <modifyDataType tableName="fleet" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="fleet" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="fleet_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="fleet_history" columnName="updated_at" newDataType="timestamp"/>

            <!-- ðŸ“± DEVICE DOMAIN -->
            <modifyDataType tableName="device" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="device" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="device" columnName="last_seen" newDataType="timestamp"/>
            <modifyDataType tableName="device" columnName="sw_update_time" newDataType="timestamp"/>
            <modifyDataType tableName="device_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="device_history" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="device_history" columnName="last_seen" newDataType="timestamp"/>
            <modifyDataType tableName="device_history" columnName="sw_update_time" newDataType="timestamp"/>

            <!-- ðŸ”‹ BMS DOMAIN -->
            <modifyDataType tableName="bms" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="bms" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="bms_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="bms_history" columnName="updated_at" newDataType="timestamp"/>

            <!-- âš¡ METER DOMAIN -->
            <modifyDataType tableName="meter" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="meter" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="meter_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="meter_history" columnName="updated_at" newDataType="timestamp"/>

            <!-- ðŸ“¡ MESSAGE DOMAIN -->
            <modifyDataType tableName="messages" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="messages" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="messages" columnName="sent_at" newDataType="timestamp"/>
            <modifyDataType tableName="messages" columnName="received_at" newDataType="timestamp"/>
            <modifyDataType tableName="message_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="message_history" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="message_history" columnName="sent_at" newDataType="timestamp"/>
            <modifyDataType tableName="message_history" columnName="received_at" newDataType="timestamp"/>

            <!-- â˜€ï¸ INVERTER DOMAIN -->
            <modifyDataType tableName="inverter" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inverter" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="inverter_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inverter_history" columnName="updated_at" newDataType="timestamp"/>

            <!-- ðŸ§  INVERTER SUBCOMPONENTS -->
            <modifyDataType tableName="inv_common" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_common" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_common_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_common_history" columnName="updated_at" newDataType="timestamp"/>

            <modifyDataType tableName="inv_nameplate" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_nameplate" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_nameplate_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_nameplate_history" columnName="updated_at" newDataType="timestamp"/>

            <modifyDataType tableName="inv_settings" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_settings" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_settings_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="inv_settings_history" columnName="updated_at" newDataType="timestamp"/>

            <!-- ðŸ” SECURITY DOMAIN -->
            <modifyDataType tableName="security_keys" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="security_keys" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="security_keys" columnName="revoked_timestamp" newDataType="timestamp"/>
            <modifyDataType tableName="security_keys_history" columnName="created_at" newDataType="timestamp"/>
            <modifyDataType tableName="security_keys_history" columnName="updated_at" newDataType="timestamp"/>
            <modifyDataType tableName="security_keys_history" columnName="revoked_timestamp" newDataType="timestamp"/>

        </rollback>
    </changeSet>
</databaseChangeLog>